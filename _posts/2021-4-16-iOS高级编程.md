---
layout: post
title: Swift
categories: Languages
---

- [iOS 高级编程](#ios-高级编程)
  - [内存管理](#内存管理)
    - [引用计数](#引用计数)
      - [实现原理](#实现原理)
    - [自动释放池](#自动释放池)
      - [IMP缓存](#imp缓存)
      - [实现原理](#实现原理-1)
    - [ARC](#arc)
  - [Block](#block)
  - [多线程](#多线程)

# iOS 高级编程

## 内存管理
### 引用计数
Reference count，表示有多少个对象指向它，通过以下行为修改：
1. 创建： alloc/new/copy/mutableCopy
2. 增加引用：retain
3. 释放引用：release
4. 销毁：dealloc

#### 实现原理
1. GNU通过在每个对象头部插入一个uint保存引用计数
2. Apple通过一张引用计数表保存所有的引用计数，key是对象的地址，value是引用计数值和那些指向这个对象的地址

### 自动释放池
autorelease不会增加引用计数，但是会把对象加入到autoreleasepool中，直到autoreleasepool被销毁时才会释放这个对象。

#### IMP缓存
把类和方法缓存起来方便快速访问。

```
id autorelease_class = [NSAutoreleasePool class];
SEL autorelease_sel = @selector(addObject:);
IMP autorelease_imp = [autorelease_class methodForSelector: autorelease_sel];

- (id) autorelease {
(*autorelease_imp)(autorelease_class, autorelease_sel, self); }
```

#### 实现原理
1. GNU通过获取当前活跃的pool，将对象加入到pool持有的容器中。
2. Apple通过poolpage类，这个类有一个类栈保存所有的pool，一个类成员保存当前活跃的poolpage对象，将对象加入到这个类成员持有的容器中。

自动释放池调用autorelease方法会报错，因为autoreleasepool重载了autorelease方法。

### ARC


## Block
## 多线程